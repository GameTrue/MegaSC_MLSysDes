PROMPT_TEMPLATE = r"""Внимательно рассмотри приложенное изображение диаграммы. Прочитай КАЖДЫЙ текст на изображении точно как он написан. НЕ ПРИДУМЫВАЙ текст — используй ТОЛЬКО то, что видишь на картинке.

Верни ТОЛЬКО валидный JSON (без markdown-блоков, без лишнего текста):
{
  "diagram_type": "bpmn|flowchart|other",
  "description": "краткое описание диаграммы на русском",
  "steps": [
    {
      "id": "<УНИКАЛЬНЫЙ числовой id: 1, 2, 3, ...>",
      "action": "<ДОСЛОВНЫЙ текст внутри узла; если текста нет — пустая строка>",
      "type": "start|end|task|decision|subprocess",
      "role": "<название swim lane (дорожки) или null>",
      "next_steps": [
        {"to": "<числовой id целевого шага>", "label": "<текст на стрелке или пустая строка>"}
      ]
    }
  ]
}

Правила:
- НЕ ВЫДУМЫВАЙ содержимое. Каждый action — ДОСЛОВНАЯ копия текста из узла на изображении.
- Если текст не читается — напиши "нечитаемо", но НЕ ПРИДУМЫВАЙ.
- Не добавляй markdown, только чистый JSON.
- Каждый шаг имеет УНИКАЛЬНЫЙ числовой id (1, 2, 3...). В next_steps.to ссылайся на эти id.
- Числовые префиксы в тексте узлов (например "7.1", "ИК 7.2") сохраняй в action.

ВАЖНО — развилки (ромбы / gateways):
- Ромб — это ОДИН шаг с type "decision". Текст внутри ромба → action.
- Исходящие стрелки из ромба имеют подписи ("Да", "Нет" и т.п.) — это next_steps.label.
- НЕ создавай отдельные шаги для "Да" и "Нет" — это подписи на стрелках, а НЕ узлы диаграммы!

Swim lanes (дорожки):
- Если диаграмма разделена на горизонтальные или вертикальные дорожки с подписями — название дорожки → поле role для всех узлов внутри неё.
- Если дорожек нет — role = null.

Типы узлов:
- Тонкий круг/овал в начале → type "start".
- Жирный круг/точка в конце → type "end".
- Прямоугольник → type "task".
- Ромб → type "decision".
- Прямоугольник с маркером "+" внизу (подпроцесс) → type "subprocess".

- Если диаграмма использует BPMN-нотацию (события, шлюзы, пулы/дорожки) → diagram_type = "bpmn".
- Порядок обхода: слева-направо, сверху-вниз от стартового узла.
"""
